<!DOCTYPE html>
<html>

<head>
    <!-- <title>Flower power!</title> -->
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- <link rel="shortcut icon" type="image/png" href="./images/flower-icon.png"/> -->
    <!-- <link rel="stylesheet" type="text/css" href="./vendor/normalize.css"> -->
    <link rel="stylesheet" type="text/css" href="./styles/main.css">
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
</head>

<body class="content">

<main class="main">

    <!-- <div>tmp</div> -->


    <!-- <table > -->
    <table style="position: absolute; top: 0; bottom: 0; left: 0; right: 0;">
        <% for(var i=0; i< 3; i++) { %>

            <tr>
                <% for(var j=0; j<3; j++) { %>
    
                <th id="foo<%= String(i) %>:<%= String(j) %>" onclick="clicked(<%= i %>, <%= j %>)">
                    <%= String(i) + ", " + String(j) %>
                
                </th>
     
                <% } %>
            </tr>    

        <% } %>



    </table>

    <script>

        function clicked(i, j) {
            
            console.log("clicked", i, j)

            document.querySelector("#foo"+i+"\\:"+j).style.backgroundColor = "blue";

        
            board[i][j] = 1;



            (async () => {
                let t= await fetch('http://localhost:3000/tmp/' + i + "/" + j + "/" + JSON.stringify(board));
                console.log(t)

                let response = await t.json();

                console.log(response)


                if (response.status == 1) {
                    alert("game won")
                } else {

                    document.querySelector("#foo"+response.y+"\\:"+response.x).style.backgroundColor = "yellow";

                    board[response["y"]][response["x"]] = -1


                    if (response.status == -1) {
                        alert("game lost")
                    }

                }


            })();

            print_board()

        }

        let x_len = 3
        let y_len = 3
        let board = Array(y_len).fill().map(() => Array(x_len));

        function print_board() {
            for (let i = 0; i < y_len; i++) {
            const element = board[i];

            console.log(element)

        }

        }

        for (let i = 0; i < y_len; i++) {
            const element = board[i];

            for (let j = 0; j < x_len; j++) {
                board[i][j] = 0
            }
            console.log(element)

        }

        // console.log(board)


    </script>

  
</main>

</body>

</html>
